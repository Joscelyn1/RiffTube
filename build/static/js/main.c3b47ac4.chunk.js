(this.webpackJsonprifftube=this.webpackJsonprifftube||[]).push([[0],{42:function(e,t,n){e.exports=n(71)},47:function(e,t,n){},52:function(e,t,n){},71:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(18),i=n.n(o),l=(n(47),n(3)),c=n(10),u=n(5),s=n(4),f=n(6),d=n(2),p=(n(52),n(37)),m=n.n(p),y="EDIT_MODE",E="EDIT_NEW_MODE",g="PLAY_MODE",b="PAUSE_MODE",v=function(e){return{type:"SET_PLAYER_MODE",payload:e}},h=function(e){function t(){var e,n;Object(l.a)(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(o)))).componentDidMount=function(){if(window.YT&&window.YT.Player)n.loadVideo();else{var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",window.onYouTubeIframeAPIReady=n.loadVideo;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}},n.loadVideo=function(){var e=n.props.id;window.rifftubePlayer&&window.rifftubePlayer.destroy(),n.player=new window.YT.Player("rifftube-player",{videoId:e,height:390,width:640,events:{onReady:n.onPlayerReady,onStateChange:n.onPlayerStateChange}}),window.rifftubePlayer=n.player},n.onPlayerReady=function(e){},n.onPlayerStateChange=function(e){var t=e.data;console.log("state change",t),console.log("cur mode",n.props.mode),1==t?(n.curRiff=n.props.riffsPlaying,n.riffInterval=setInterval((function(){var e=window.rifftubePlayer.getCurrentTime();n.props.riffs.forEach((function(t,r){n.curRiff[r]&&(e<t.time||e>t.time+t.duration)&&(n.props.setRiffPlaying(r,!1),n.curRiff[r]=!1,"audio"==t.type&&window.rifftubePlayer.setVolume(n.vol))})),n.props.riffs.forEach((function(t,r){if(!n.curRiff[r]&&e>t.time&&e<t.time+.5&&(n.props.setRiffPlaying(r,!0),n.curRiff[r]=!0,"audio"==t.type)){n.vol=window.rifftubePlayer.getVolume(),window.rifftubePlayer.setVolume(.5*n.vol);var a=document.createElement("audio");a.controls=!1,a.src=t.payload,a.play()}}))}),100),n.props.mode==b&&(n.props.setPlayerMode(g),console.log("paused to play"))):(clearInterval(n.riffInterval),n.props.mode==g&&(n.props.setPlayerMode(b),console.log("play to paused")))},n.componentDidUpdate=function(e){n.props.id!=e.id&&n.loadVideo(),n.props.mode!=e.mode&&(n.props.mode!=y&&n.props.mode!=E&&n.props.mode!=b||1!=n.player.getPlayerState()?n.props.mode==g&&1!=n.player.getPlayerState()&&(console.log("playVideo"),n.player.playVideo()):(console.log("pauseVideo"),n.player.pauseVideo()))},n.render=function(){return console.log("render vid",n.props.riffsPlaying),a.a.createElement("div",{style:{position:"relative"}},a.a.createElement("div",{id:"rifftube-player"}),Object.keys(n.props.riffsPlaying).filter((function(e){return n.props.riffsPlaying[e]})).map((function(e){return a.a.createElement("div",{style:{position:"absolute",width:"100%",height:"390px",lineHeight:"390px",top:0,textAlign:"center",pointerEvents:"none"}},a.a.createElement("div",{style:{display:"inline-block",verticalAlign:"middle",width:"640px",font:"36pt serif",backgroundColor:"rgba(255,255,255,33%"}},"text"==n.props.riffs[e].type?n.props.riffs[e].payload:null))})))},n}return Object(f.a)(t,e),t}(a.a.Component),O={setPlayerMode:v,setRiffPlaying:function(e,t){return{type:t?"SET_RIFF_PLAYING":"SET_RIFF_NOT_PLAYING",payload:e}},togglePlayerMode:function(e){return{type:"TOGGLE_PLAYER_MODE"}}},R=Object(d.b)((function(e){return{id:e.videoID,mode:e.mode,riffs:e.riffs,riffsPlaying:e.riffsPlaying}}),O)(h),P=n(38),j=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement(P.GoogleLogin,{socialId:"941154439836-s6iglcrdckcj6od74kssqsom58j96hd8.apps.googleusercontent.com",className:"google-login",scope:"profile",fetchBasicProfile:!1,responseHandler:this.props.setGoogleUser,buttonText:"Login With Google"}))}}]),t}(a.a.Component),_={setGoogleUser:function(e){return{type:"GOOGLE_USER_SIGNIN",payload:e}}},I=Object(d.b)(null,_)(j),w=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(s.a)(t).call(this,e))).state={mediaRecorder:null,recordingState:!1},n}return Object(f.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;navigator.mediaDevices&&navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){var n=new MediaRecorder(t);n.ondataavailable=function(t){e.chunks.push(t.data)},n.onstop=function(t){var n=new Blob(e.chunks,{type:"audio/webm"}),r=URL.createObjectURL(n);e.props.saveTempAudio(r,e.duration)},e.setState({mediaRecorder:n})})).catch((function(e){return console.log("Error",e)}))}},{key:"render",value:function(){var e=this;return navigator.mediaDevices&&this.state.mediaRecorder?this.state.recordingState?a.a.createElement("button",{id:"recordBtn",onClick:function(){e.setState({recordingState:!1}),e.duration=(Date.now()-e.startTime)/1e3,e.state.mediaRecorder.stop()}},"stop"):a.a.createElement("button",{id:"recordBtn",onClick:function(){e.setState({recordingState:!0}),e.chunks=[],e.startTime=Date.now(),e.state.mediaRecorder.start()}},"record"):navigator.mediaDevices&&!this.state.mediaRecorder?a.a.createElement("span",null,"mediaRecorder failed to initialize"):a.a.createElement("span",null,"navigator.mediaDevices not supported. sorry.")}}]),t}(a.a.Component),T=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement("button",{id:"test-post-button",onClick:function(){e.props.sendGoogleToken(e.props.googleUser.getAuthResponse().id_token)}},"test verify token")}}]),t}(a.a.Component),D={sendGoogleToken:function(e){return function(t){t({type:"SEND_ACCESS_TOKEN"}),m.a.post("http://localhost:3300/verify-token",{token:e}).then((function(e){t({type:"SEND_ACCESS_TOKEN_SUCCESS",payload:e.data})})).catch((function(e){t({type:"SEND_ACCESS_TOKEN_FAILURE",payload:e.response})}))}}},S=Object(d.b)((function(e){return{googleUser:e.googleUser}}),D)(T);var C={editRiff:function(e){return{type:"EDIT_RIFF",payload:e}}},k=Object(d.b)(null,C)((function(e){return a.a.createElement("div",{className:"riff-detail"},a.a.createElement("div",{style:{backgroundColor:e.selected?"lightpink":"white"}},a.a.createElement("button",{onClick:function(){return e.editRiff(e.index)}},"Edit"),a.a.createElement("span",null,"Riff info: ",JSON.stringify(e))))}));var A=Object(d.b)((function(e){return{riffs:e.riffs,riffsPlaying:e.riffsPlaying}}),null)((function(e){return a.a.createElement("div",null,e.riffs?e.riffs.map((function(t,n){return a.a.createElement(k,Object.assign({},t,{index:n,selected:!0===e.riffsPlaying[n]}))})):null)})),F=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement("div",{style:{border:"1px solid black",padding:"1em"}},"audio"==this.props.tempRiff.type?a.a.createElement(a.a.Fragment,null,a.a.createElement("br",null),a.a.createElement(w,{saveTempAudio:this.props.saveTempAudio}),this.props.tempRiff.payload?a.a.createElement("button",{onClick:function(){var t=document.createElement("audio");t.controls=!1,t.src=e.props.tempRiff.payload,t.play()}},"Play"):null,a.a.createElement("br",null),a.a.createElement("button",{disabled:!this.props.tempRiff.payload,onClick:function(){e.props.saveRiff({payload:e.props.tempRiff.payload})}},"Save")):a.a.createElement(a.a.Fragment,null,a.a.createElement("div",null,"HTML payload:"),a.a.createElement("textarea",{id:"riff-edit-field"},this.props.tempRiff.payload),a.a.createElement("div",null,"Duration: ",a.a.createElement("input",{id:"riff-duration-field",defaultValue:this.props.tempRiff.duration||2})),a.a.createElement("button",{onClick:function(){e.props.saveRiff({payload:document.querySelector("#riff-edit-field").value,duration:Number(document.querySelector("#riff-duration-field").value)})}},"Save")),a.a.createElement("button",{onClick:function(){e.props.cancelEdit()}},"Cancel"))}}]),t}(a.a.Component),N={setPlayerMode:v,saveRiff:function(e){return{type:"SAVE_RIFF",payload:e}},saveTempAudio:function(e,t){return{type:"SAVE_TEMP_AUDIO",payload:e,duration:t}},cancelEdit:function(){return{type:"CANCEL_EDIT"}}},U=Object(d.b)((function(e){return{mode:e.mode,tempRiff:e.tempRiff}}),N)(F),M=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return a.a.createElement("button",{onClick:this.props.createTempRiff.bind(null,this.props.type)},this.props.type)}}]),t}(a.a.Component),V={createTempRiff:function(e){return{type:"audio"==e?"CREATE_TEMP_AUDIO_RIFF":"CREATE_TEMP_TEXT_RIFF"}}},L=Object(d.b)(null,V)(M);var G=Object(d.b)((function(e){return{mode:e.mode}}),null)((function(e){return a.a.createElement("div",null,a.a.createElement("div",null,a.a.createElement(L,{type:"audio"}),a.a.createElement(L,{type:"text"}),"||",a.a.createElement(S,null),e.mode==y||e.mode==E?a.a.createElement(U,null):null),a.a.createElement("div",null,a.a.createElement(A,null)))})),x=n(39),Y=n(15),B=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(s.a)(t).call(this,e))).loggedIn=function(){return!!n.props.googleUser&&n.props.googleUser.isSignedIn()},n.authCheck=function(e,t){return n.loggedIn()?a.a.createElement(e,null):a.a.createElement(t,null)},n.videoIDRef=a.a.createRef(),n}return Object(f.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement(x.a,null,a.a.createElement("div",{className:"App"},a.a.createElement("form",null,a.a.createElement("label",null,"Your Youtube Video:",a.a.createElement("input",{type:"text",defaultValue:this.props.videoID,ref:this.videoIDRef}),a.a.createElement("button",{type:"button",onClick:function(t){e.props.setVideoID(e.videoIDRef.current.value)}},"Change Video"))),a.a.createElement(R,null),a.a.createElement(Y.c,null,a.a.createElement(Y.a,{exact:!0,path:"/",render:this.authCheck.bind(this,G,I)}))))}}]),t}(a.a.Component),W={setVideoID:function(e){return{type:"SET_VIDEO_ID",payload:e}}},q=Object(d.b)((function(e){return{videoID:e.videoID,googleUser:e.googleUser}}),W)(B);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var H=n(25),J=n(20);function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(n,!0).forEach((function(t){Object(J.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var z={videoID:"8N_tupPBtWQ",googleUser:null,riffs:[],tempRiff:null,mode:b,riffsPlaying:{}},Q=n(17),$=n(41),Z=Object(Q.c)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_VIDEO_ID":return{videoID:t.payload,googleUser:e.googleUser,riffs:[],tempRiff:null,mode:b,riffsPlaying:{}};case"GOOGLE_USER_SIGNIN":return X({},e,{googleUser:t.payload});case"CREATE_TEMP_AUDIO_RIFF":return X({},e,{tempRiff:{type:"audio",time:window.rifftubePlayer.getCurrentTime()},mode:E});case"CREATE_TEMP_TEXT_RIFF":return X({},e,{tempRiff:{type:"text",time:window.rifftubePlayer.getCurrentTime()},mode:E});case"EDIT_RIFF":return X({},e,{tempRiff:X({},e.riffs[t.payload]),editIndex:t.payload,mode:y});case"SET_PLAYER_MODE":return X({},e,{mode:t.payload});case"SAVE_TEMP_AUDIO":return X({},e,{tempRiff:X({},e.tempRiff,{duration:t.duration,payload:t.payload})});case"CANCEL_EDIT":return X({},e,{tempRiff:null,editIndex:null,mode:b});case"SET_RIFF_PLAYING":return X({},e,{riffsPlaying:X({},e.riffsPlaying,Object(J.a)({},t.payload,!0))});case"SET_RIFF_NOT_PLAYING":return X({},e,{riffsPlaying:X({},e.riffsPlaying,Object(J.a)({},t.payload,!1))});case"TOGGLE_PLAYER_MODE":return X({},e,{mode:e.mode==g?b:g});case"SAVE_RIFF":var n,r=X({},e.tempRiff,{},t.payload);return e.mode==E?n=[].concat(Object(H.a)(e.riffs),[r]):(n=Object(H.a)(e.riffs))[e.editIndex]=r,X({},e,{riffs:n,tempRiff:null,mode:g});default:return console.log("uncaught action!"),e}}),Object(Q.a)($.a));i.a.render(a.a.createElement(d.a,{store:Z},a.a.createElement(q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[42,1,2]]]);
//# sourceMappingURL=main.c3b47ac4.chunk.js.map
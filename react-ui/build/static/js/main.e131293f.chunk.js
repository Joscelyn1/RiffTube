(this.webpackJsonprifftube=this.webpackJsonprifftube||[]).push([[0],{42:function(e,t,a){e.exports=a(70)},47:function(e,t,a){},70:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(19),i=a.n(o),l=(a(47),a(6)),c=a(12),d=a(8),f=a(7),s=a(9),u=a(2),p=a(21),m=a.n(p),y="EDIT_MODE",E="EDIT_NEW_MODE",g="PLAY_MODE",v="PAUSE_MODE",b=function(e){return{type:"SET_PLAYER_MODE",payload:e}},h=function(e,t,a){m()({method:"post",url:"http://localhost:3300/load-riff",responseType:"arraybuffer",data:{token:a.getAuthResponse().id_token,id:t}}).then((function(a){e({type:"RIFF_LOADED",payload:a.data,id:t})}))},R=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(o)))).componentDidMount=function(){if(window.YT&&window.YT.Player)a.loadVideo();else{var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",window.onYouTubeIframeAPIReady=a.loadVideo;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}},a.loadVideo=function(){var e=a.props.id;window.rifftubePlayer&&window.rifftubePlayer.destroy(),a.player=new window.YT.Player("rifftube-player",{videoId:e,height:390,width:640,events:{onReady:a.onPlayerReady,onStateChange:a.onPlayerStateChange}}),window.rifftubePlayer=a.player},a.onPlayerReady=function(e){},a.checkForRiffsToLoad=function(e){a.props.riffs.forEach((function(t){"audio"===t.type&&!t.payload&&!t.loading&&t.time>=e&&t.time<e+10&&a.props.loadRiff(t.id,a.props.googleUser)}))},a.onPlayerStateChange=function(e){1===e.data?(a.curRiff=a.props.riffsPlaying,a.riffInterval=setInterval((function(){var e=window.rifftubePlayer.getCurrentTime();a.checkForRiffsToLoad(e),a.props.riffs.forEach((function(t,n){a.curRiff[n]&&(e<t.time||e>t.time+t.duration)&&(a.props.setRiffPlaying(n,!1),a.curRiff[n]=!1,"audio"===t.type&&window.rifftubePlayer.setVolume(a.vol))})),a.props.riffs.forEach((function(t,n){if(!a.curRiff[n]&&e>t.time&&e<t.time+.5&&(a.props.setRiffPlaying(n,!0),a.curRiff[n]=!0,"audio"===t.type)){a.vol=window.rifftubePlayer.getVolume(),window.rifftubePlayer.setVolume(.5*a.vol);var r=document.createElement("audio");if(r.controls=!1,!t.payload)return;var o=URL.createObjectURL(t.payload);r.src=o,r.play()}}))}),100),a.props.mode===v&&a.props.setPlayerMode(g)):(clearInterval(a.riffInterval),a.props.mode===g&&a.props.setPlayerMode(v))},a.componentDidUpdate=function(e){a.checkForRiffsToLoad(0),a.props.id!==e.id&&a.loadVideo(),a.props.mode!==e.mode&&(a.props.mode!==y&&a.props.mode!==E&&a.props.mode!==v||1!==a.player.getPlayerState()?a.props.mode===g&&1!==a.player.getPlayerState()&&a.player.playVideo():a.player.pauseVideo())},a.render=function(){return r.a.createElement("div",{className:"rifftube-container"},r.a.createElement("div",{id:"rifftube-player"}),Object.keys(a.props.riffsPlaying).filter((function(e){return a.props.riffsPlaying[e]})).map((function(e){return r.a.createElement("div",{key:e},r.a.createElement("div",null,"text"===a.props.riffs[e].type?a.props.riffs[e].payload:null))})))},a}return Object(s.a)(t,e),t}(r.a.Component),I={setPlayerMode:b,setRiffPlaying:function(e,t){return{type:t?"SET_RIFF_PLAYING":"SET_RIFF_NOT_PLAYING",payload:e}},togglePlayerMode:function(e){return{type:"TOGGLE_PLAYER_MODE"}},loadRiff:function(e,t){return function(a){h(a,e,t)}}},O=Object(u.b)((function(e){return{id:e.videoID,mode:e.mode,riffs:e.riffs,riffsPlaying:e.riffsPlaying,googleUser:e.googleUser}}),I)(R),_=a(38),D=function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(_.GoogleLogin,{socialId:"941154439836-s6iglcrdckcj6od74kssqsom58j96hd8.apps.googleusercontent.com",className:"google-login",scope:"profile email",fetchBasicProfile:!1,responseHandler:function(t){e.props.setGoogleUser(t,e.props.videoID)},buttonText:"Login With Google"})}}]),t}(r.a.Component),P={setGoogleUser:function(e,t){return function(a){a({type:"GOOGLE_USER_SIGNIN",payload:e}),m()({method:"post",url:"http://localhost:3300/get-riffs",data:{token:e.getAuthResponse().id_token,videoID:t}}).then((function(e){a({type:"RECEIVE_RIFF_LIST",payload:e.data})}))}}},j=Object(u.b)((function(e){return{videoID:e.videoID}}),P)(D);var T={editRiff:function(e,t,a){return function(n){n({type:"EDIT_RIFF",payload:e}),t&&h(n,t,a)}}},w=Object(u.b)((function(e){return{googleUser:e.googleUser}}),T)((function(e){return r.a.createElement("div",{className:"riff-detail"},r.a.createElement("div",null,r.a.createElement("ul",{className:"riff-detail-list"},r.a.createElement("li",null,"No. ",e.id),r.a.createElement("li",null,"start time: ",e.start_time?e.start_time.toFixed(2):null),r.a.createElement("li",null,"type: ",e.type),r.a.createElement("li",null,"duration: ",e.duration?e.duration.toFixed(2):null)),r.a.createElement("button",{onClick:function(){return e.editRiff(e.index,"audio"!==e.type||e.payload?null:e.id,e.googleUser)}},"Edit")))}));var F=Object(u.b)((function(e){return{riffs:e.riffs,riffsPlaying:e.riffsPlaying}}),null)((function(e){return console.log("display",e.riffs),r.a.createElement("div",{className:"list-of-riffs"},e.riffs?e.riffs.map((function(t,a){return r.a.createElement(w,Object.assign({key:t.id},t,{index:a,selected:!0===e.riffsPlaying[a]}))})):null)})),S=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(d.a)(this,Object(f.a)(t).call(this,e))).state={mediaRecorder:null,recordingState:!1},a}return Object(s.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;navigator.mediaDevices&&navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){var a=new MediaRecorder(t);a.ondataavailable=function(t){e.chunks.push(t.data)},a.onstop=function(t){var a=new Blob(e.chunks,{type:"audio/webm"});e.props.saveTempAudio(a,e.duration)},e.setState({mediaRecorder:a})})).catch((function(e){return console.log("Error",e)}))}},{key:"render",value:function(){var e=this;return navigator.mediaDevices&&this.state.mediaRecorder?this.state.recordingState?r.a.createElement("button",{id:"stopBtn",onClick:function(){e.setState({recordingState:!1}),e.duration=(Date.now()-e.startTime)/1e3,e.state.mediaRecorder.stop()}},"stop"):r.a.createElement("button",{id:"recordBtn",onClick:function(){e.setState({recordingState:!0}),e.chunks=[],e.startTime=Date.now(),e.state.mediaRecorder.start()}},"record"):navigator.mediaDevices&&!this.state.mediaRecorder?r.a.createElement("span",null,"mediaRecorder failed to initialize"):r.a.createElement("span",null,"navigator.mediaDevices not supported. sorry.")}}]),t}(r.a.Component),A=function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return console.log("ed rif red"),r.a.createElement("div",{className:"edit-riff"},r.a.createElement("div",{className:"edit-riff-inner"},"audio"===this.props.tempRiff.type?r.a.createElement(r.a.Fragment,null,this.props.mode!==y||this.props.tempRiff.payload?null:r.a.createElement("span",null,"Loading..."),r.a.createElement(S,{saveTempAudio:this.props.saveTempAudio}),this.props.tempRiff.payload?r.a.createElement("button",{onClick:function(){var t=document.createElement("audio");t.controls=!1;var a=URL.createObjectURL(e.props.tempRiff.payload);t.src=a,t.play()}},"Play"):null,r.a.createElement("br",null),r.a.createElement("button",{disabled:!this.props.tempRiff.payload,onClick:function(){e.props.saveRiff(e.props.googleUser.getAuthResponse().id_token,{payload:e.props.tempRiff.payload},e.props.tempRiff)}},"Save")):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,"HTML payload:"),r.a.createElement("textarea",{id:"riff-edit-field"},this.props.tempRiff.payload),r.a.createElement("div",null,"Duration:"," ",r.a.createElement("input",{id:"riff-duration-field",defaultValue:this.props.tempRiff.duration||2})),r.a.createElement("button",{onClick:function(){e.props.saveRiff(e.props.googleUser.getAuthResponse().id_token,{payload:document.querySelector("#riff-edit-field").value,duration:Number(document.querySelector("#riff-duration-field").value)},e.props.tempRiff)}},"Save")),r.a.createElement("button",{onClick:function(){e.props.cancelEdit()}},"Cancel")))}}]),t}(r.a.Component),C={setPlayerMode:b,saveRiff:function(e,t,a){return function(n){n({type:"SAVE_RIFF",payload:t});var r=new FormData;r.append("token",e),r.append("text"===a.type?"text":"blob",t.payload),r.append("type",a.type),r.append("duration","text"===a.type?t.duration:a.duration),r.append("start_time",a.time),r.append("video_id",a.video_id),r.append("tempId",a.tempId),r.append("id",a.id),m()({method:"post",url:"http://localhost:3300/save-riff",data:r,headers:{"Content-Type":"multipart/form-data"}}).then((function(e){n({type:"SAVE_RIFF_SUCCESS",payload:e.data})})).catch((function(e){n({type:"SAVE_RIFF_FAILURE",payload:e.response})}))}},saveTempAudio:function(e,t){return{type:"SAVE_TEMP_AUDIO",payload:e,duration:t}},cancelEdit:function(){return{type:"CANCEL_EDIT"}}},k=Object(u.b)((function(e){return{mode:e.mode,tempRiff:e.tempRiff,googleUser:e.googleUser}}),C)(A),U=function(e){function t(){return Object(l.a)(this,t),Object(d.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("button",{onClick:this.props.createTempRiff.bind(null,this.props.type)},this.props.type)}}]),t}(r.a.Component),L={createTempRiff:function(e){return{type:"audio"===e?"CREATE_TEMP_AUDIO_RIFF":"CREATE_TEMP_TEXT_RIFF"}}},N=Object(u.b)(null,L)(U);var V=Object(u.b)((function(e){return{mode:e.mode}}),null)((function(e){return r.a.createElement("div",{className:"control-panel"},r.a.createElement("div",null,r.a.createElement("h2",{className:"add-riff-title"},"Add New Riff"),r.a.createElement(N,{type:"audio"}),r.a.createElement(N,{type:"text"}),e.mode===y||e.mode===E?r.a.createElement(k,null):null),r.a.createElement("h2",{className:"riff-list-title"},"Control Panel"),r.a.createElement(F,null))})),x=a(39),M=a(15),G=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(d.a)(this,Object(f.a)(t).call(this,e))).loggedIn=function(){return!!a.props.googleUser&&a.props.googleUser.isSignedIn()},a.authCheck=function(e,t){return a.loggedIn()?r.a.createElement(e,null):r.a.createElement(t,null)},a.extractVideoID=function(e){var t=e.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/);if(t&&11===t[7].length)return t[7];alert("Could not extract video ID.")},a.videoIDRef=r.a.createRef(),a}return Object(s.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(x.a,null,r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"top-section"},r.a.createElement("div",{className:"title-and-url"},r.a.createElement("h1",null,"RiffTub"),r.a.createElement("form",{onSubmit:function(t){e.props.setVideoID(e.extractVideoID(e.videoIDRef.current.value)),t.preventDefault()}},r.a.createElement("label",null,"YouTube URL/ID:\xa0\xa0"),r.a.createElement("input",{type:"text",defaultValue:this.props.videoID,ref:this.videoIDRef}),r.a.createElement("button",{type:"button",onClick:function(t){e.props.setVideoID(e.extractVideoID(e.videoIDRef.current.value))}},"Change Video"))),r.a.createElement(O,null)),r.a.createElement(M.c,null,r.a.createElement(M.a,{exact:!0,path:"/",render:this.authCheck.bind(this,V,j)}))))}}]),t}(r.a.Component),Y={setVideoID:function(e){return{type:"SET_VIDEO_ID",payload:e}}},B=Object(u.b)((function(e){return{videoID:e.videoID,googleUser:e.googleUser}}),Y)(G);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var W=a(16),q=a(22);function H(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function J(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?H(a,!0).forEach((function(t){Object(q.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):H(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var X={videoID:"lYIRO97dhII",googleUser:null,riffs:[],tempRiff:null,mode:v,riffsPlaying:{}},z=a(18),$=a(41),K=Object(z.c)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X,t=arguments.length>1?arguments[1]:void 0;switch(console.log("dispatch",t,e),t.type){case"SET_VIDEO_ID":return{videoID:t.payload,googleUser:e.googleUser,riffs:[],tempRiff:null,mode:v,riffsPlaying:{}};case"GOOGLE_USER_SIGNIN":return J({},e,{googleUser:t.payload});case"CREATE_TEMP_AUDIO_RIFF":case"CREATE_TEMP_TEXT_RIFF":return J({},e,{tempRiff:{type:"CREATE_TEMP_AUDIO_RIFF"===t.type?"audio":"text",time:window.rifftubePlayer.getCurrentTime(),video_id:e.videoID,tempId:(new Date).getUTCMilliseconds()},mode:E});case"EDIT_RIFF":return J({},e,{tempRiff:J({},e.riffs[t.payload]),editIndex:t.payload,mode:y});case"SET_PLAYER_MODE":return J({},e,{mode:t.payload});case"SAVE_TEMP_AUDIO":return J({},e,{tempRiff:J({},e.tempRiff,{duration:t.duration,payload:t.payload})});case"CANCEL_EDIT":return J({},e,{tempRiff:null,editIndex:null,mode:v});case"SET_RIFF_PLAYING":return J({},e,{riffsPlaying:J({},e.riffsPlaying,Object(q.a)({},t.payload,!0))});case"SET_RIFF_NOT_PLAYING":return J({},e,{riffsPlaying:J({},e.riffsPlaying,Object(q.a)({},t.payload,!1))});case"TOGGLE_PLAYER_MODE":return J({},e,{mode:e.mode===g?v:g});case"RECEIVE_RIFF_LIST":return J({},e,{riffs:[].concat(Object(W.a)(e.riffs),Object(W.a)(t.payload.body.map((function(e){return J({},e,{time:e.start_time,payload:e.isText?e.text:null,type:e.isText?"text":"audio"})}))))});case"SAVE_RIFF_SUCCESS":if("add"===t.payload.type){var a=Object(W.a)(e.riffs);a.forEach((function(e){e.tempId===t.payload.tempId&&(e.id=t.payload.id)}));var n=J({},e,{riffs:a});return n}return e;case"SAVE_RIFF":var r,o=J({},e.tempRiff,{},t.payload);return e.mode===E?r=[].concat(Object(W.a)(e.riffs),[o]):(r=Object(W.a)(e.riffs))[e.editIndex]=o,J({},e,{riffs:r,tempRiff:null,mode:g});case"LOAD_RIFF":var i=J({},e);return i.riffs[t.payload].loading=!0,i;case"RIFF_LOADED":var l=new Blob(new Array(t.payload),{type:"audio/webm"}),c=Object(W.a)(e.riffs);c.forEach((function(e){e.id===t.id&&(e.payload=l,e.loading=!1)}));var d=J({},e,{riffs:c});return e.mode===y&&e.tempRiff.id===t.id&&(d.tempRiff=J({},d.tempRiff,{payload:l})),d;default:return e}}),Object(z.a)($.a));i.a.render(r.a.createElement(u.a,{store:K},r.a.createElement(B,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[42,1,2]]]);
//# sourceMappingURL=main.e131293f.chunk.js.map